require(data.table) # fread and data.table
require(bit64) # dealing with integer64 issue when fread
###############################################################################################
## 1. load the data ###########################################################################
###############################################################################################
load("RData/dtRaw.RData")

###############################################################################################
## 2. take a look #############################################################################
###############################################################################################
dim(dtRawTrain)
# [1] 145231   1934
dim(dtRawTest)
# [1] 145232   1933
summary(dtRawTrain)
str(dtRawTrain)

##################################
## 2.1 number of NAs per column ##
##################################
CheckColNAs <- function(dt){
    intNAs <- apply(dt, 2, function (x) sum(is.na(x)))
    intColNAs <- intNAs[intNAs != 0]
}
intColNAs.train <- CheckColNAs(dtRawTrain) # 476 columns in the train set with NAs
intColNAs.test <- CheckColNAs(dtRawTest) # 476 columns in the test set with NAs

## check if the NA columns in the train and the test are the same
sum(names(intColNAs.train) == names(intColNAs.test)) # 476, meaning they are the same

## calculate the percentage of NAs of each column with NAs
numPercColNAS.train <- intColNAs.train / nrow(dtRawTrain)
numPercColNAS.test <- intColNAs.test / nrow(dtRawTest)

sum(numPercColNAS.train > .1) # 10 columns in the train have more than half NAs
sum(numPercColNAS.test > .1) # 10 columns in the test have more than half NAs

table(cut(numPercColNAS.train, 10)) # 10 columns have more than 60% of NAs
# (-0.000614,0.1]       (0.1,0.2]       (0.2,0.3]       (0.3,0.4] 
# 466                   0               0               0 
# (0.4,0.5]             (0.5,0.6]       (0.6,0.7]       (0.7,0.8] 
# 0                     0               1               0 
# (0.8,0.9]             (0.9,1] 
# 3                     6 
table(cut(numPercColNAS.test, 10)) # 10 columns have more than 60% of NAs
# (-0.000669,0.1]       (0.1,0.2]       (0.2,0.3]       (0.3,0.4] 
# 466                   0               0               0 
# (0.4,0.5]             (0.5,0.6]       (0.6,0.7]       (0.7,0.8] 
# 0                     0               1               0 
# (0.8,0.9]             (0.9,1] 
# 3                     6 

## check if the 10 NA columns in the train and the test are the same
sum(names(numPercColNAS.train)[numPercColNAS.train > .6] == names(numPercColNAS.test)[numPercColNAS.test > .6]) # 10, meaning they are the same

## check the NA columns
# start from the above 10 columns
nameColNAs.6 <- names(numPercColNAS.train)[numPercColNAS.train > .6]
str(dtRawTrain[, nameColNAs.6, with = F])
# $ VAR_0074: int  NA 5208 NA NA NA NA NA NA 2487 NA ...
# $ VAR_0205: int  NA NA NA NA NA NA NA NA NA NA ...
# $ VAR_0206: int  NA NA NA NA NA NA NA NA NA NA ...
# $ VAR_0207: logi  NA NA NA NA NA NA ...
# $ VAR_0208: int  NA 146 NA NA NA NA NA NA NA NA ...
# $ VAR_0209: int  NA NA NA NA NA NA NA NA NA NA ...
# $ VAR_0210: int  NA 146 NA NA NA NA NA NA NA NA ...
# $ VAR_0211: int  NA 146 NA NA NA NA NA NA NA NA ...
# $ VAR_0213: logi  NA NA NA NA NA NA ...
# $ VAR_0840: logi  NA NA NA NA NA NA ...
# check the rest
nameColNAs.0 <- names(numPercColNAS.train)[numPercColNAS.train <= .6]
str(dtRawTrain[, nameColNAs.0, with = F])
# $ VAR_0006: int  0 1 0 0 0 0 1 0 1 0 ...
# $ VAR_0007: int  0 0 0 0 0 0 1 0 1 0 ...
# $ VAR_0013: int  0 1 0 0 0 0 1 0 1 0 ...
# $ VAR_0014: int  0 0 0 0 0 0 1 0 1 0 ...
# $ VAR_0015: int  0 1 0 0 0 0 1 0 1 0 ...
# $ VAR_0016: int  1 2 1 2 1 1 2 1 1 1 ...
# $ VAR_0017: int  0 1 0 0 0 0 0 0 1 0 ...
# $ VAR_0018: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0019: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0020: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0021: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0022: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0023: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0024: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0025: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0026: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0027: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0028: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0029: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0030: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0031: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0032: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0033: int  1 1 1 1 1 1 2 1 1 2 ...
# $ VAR_0034: int  0 0 0 0 0 0 2 0 1 1 ...
# $ VAR_0035: int  0 0 0 0 0 0 2 0 1 1 ...
# $ VAR_0036: int  0 0 0 0 0 0 1 0 1 1 ...
# $ VAR_0037: int  0 0 0 0 0 0 1 0 1 1 ...
# $ VAR_0038: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0039: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0040: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0041: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0042: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0045: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0046: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0047: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0048: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0049: int  0 1 0 0 0 0 0 0 0 0 ...
# $ VAR_0050: int  0 1 0 0 0 0 0 0 0 0 ...
# $ VAR_0051: int  0 1 0 1 0 0 0 0 0 0 ...
# $ VAR_0052: int  1 1 1 1 1 1 1 1 1 1 ...
# $ VAR_0053: int  1 2 1 1 1 1 1 1 1 1 ...
# $ VAR_0054: int  1 2 1 1 1 1 1 1 1 1 ...
# $ VAR_0055: int  1 2 1 1 1 1 1 1 1 1 ...
# $ VAR_0056: int  1 3 1 1 1 1 1 1 1 1 ...
# $ VAR_0057: int  1 3 1 1 1 1 1 1 1 1 ...
# $ VAR_0058: int  1 3 1 1 1 1 1 1 1 1 ...
# $ VAR_0059: int  1 1 1 1 1 1 2 1 1 1 ...
# $ VAR_0060: int  1 2 1 1 1 1 2 1 1 1 ...
# $ VAR_0061: int  1 2 1 1 1 1 2 1 1 1 ...
# $ VAR_0062: int  1 2 1 1 1 1 2 1 2 1 ...
# $ VAR_0063: int  1 3 1 1 1 1 3 1 2 1 ...
# $ VAR_0064: int  1 3 1 1 1 1 3 1 2 1 ...
# $ VAR_0065: int  1 3 1 1 1 1 3 1 2 1 ...
# $ VAR_0066: int  0 0 0 0 0 0 1 0 0 0 ...
# $ VAR_0067: int  0 0 0 0 0 0 1 0 0 0 ...
# $ VAR_0068: int  0 0 0 0 0 0 1 0 0 0 ...
# $ VAR_0069: int  0 0 0 0 0 0 1 0 1 0 ...
# $ VAR_0070: int  0 0 0 0 0 0 2 0 1 0 ...
# $ VAR_0071: int  0 0 0 0 0 0 2 0 1 0 ...
# $ VAR_0072: int  0 0 0 0 0 0 2 0 1 0 ...
# $ VAR_0076: int  1 1 1 1 1 1 2 1 1 1 ...
# $ VAR_0077: int  1 2 1 1 1 1 2 1 1 1 ...
# $ VAR_0078: int  1 2 1 1 1 1 2 1 1 1 ...
# $ VAR_0079: int  1 2 1 1 1 1 2 1 2 1 ...
# $ VAR_0080: int  1 3 1 1 1 1 3 1 2 1 ...
# $ VAR_0081: int  1 3 1 1 1 1 3 1 2 1 ...
# $ VAR_0082: int  1 3 1 1 1 1 3 1 2 1 ...
# $ VAR_0083: int  1 1 1 1 1 1 2 1 1 1 ...
# $ VAR_0084: int  1 2 1 1 1 1 2 1 1 1 ...
# $ VAR_0085: int  1 2 1 1 1 1 2 1 1 1 ...
# $ VAR_0086: int  1 2 1 1 1 1 2 1 2 1 ...
# $ VAR_0087: int  1 4 1 1 1 1 3 1 2 1 ...
# $ VAR_0088: int  1 4 1 1 1 1 3 1 2 1 ...
# $ VAR_0089: int  1 4 1 2 1 1 3 1 2 1 ...
# $ VAR_0090: int  0 1 1 1 1 1 1 1 1 1 ...
# $ VAR_0091: int  0 1 1 1 1 1 1 1 1 1 ...
# $ VAR_0092: int  0 1 1 1 1 1 1 1 1 1 ...
# $ VAR_0093: int  0 1 1 1 1 1 1 1 1 1 ...
# $ VAR_0094: int  0 1 1 1 1 1 1 1 1 1 ...
# $ VAR_0095: int  0 1 1 1 1 1 1 1 1 1 ...
# $ VAR_0096: int  0 1 1 1 1 1 1 1 1 1 ...
# $ VAR_0097: int  0 1 1 1 1 1 1 1 1 1 ...
# $ VAR_0098: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0099: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0100: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0101: int  0 0 0 0 0 0 1 0 0 0 ...
# $ VAR_0102: int  0 0 0 0 0 0 1 0 0 0 ...
# $ VAR_0103: int  0 0 0 0 0 0 1 0 0 0 ...
# $ VAR_0104: int  0 1 0 0 0 0 1 0 0 0 ...
# $ VAR_0105: int  0 1 0 0 0 0 1 0 1 0 ...
# $ VAR_0106: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0107: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0108: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0109: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0110: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0111: int  0 0 0 0 0 0 0 0 0 0 ...
# $ VAR_0112: int  0 1 0 0 0 0 0 0 0 0 ...
# $ VAR_0113: int  0 1 0 0 0 0 0 0 1 0 ...
# $ VAR_0114: int  0 0 0 0 0 0 0 0 0 0 ...

##################################
## 2.2 check the class of columns 
##################################
charColClass <- unlist(lapply(dtRawTrain, class))
table(charColClass)
# character     integer         integer64   logical     numeric 
# 51            1869            1           3           10 

## check the character columns
charColClassChar <- charColClass[charColClass == "character"]
str(dtRawTrain[, names(charColClassChar), with = F])
# $ VAR_0001: chr  "H" "H" "H" "H" ...
# $ VAR_0005: chr  "C" "B" "C" "C" ...
# $ VAR_0008: chr  "false" "false" "false" "false" ...
# $ VAR_0009: chr  "false" "false" "false" "false" ...
# $ VAR_0010: chr  "false" "false" "false" "false" ...
# $ VAR_0011: chr  "false" "false" "false" "false" ...
# $ VAR_0012: chr  "false" "false" "false" "false" ...
# $ VAR_0043: chr  "false" "false" "false" "false" ...
# $ VAR_0044: chr  "[]" "[]" "[]" "[]" ...
# $ VAR_0073: chr  "" "04SEP12:00:00:00" "" "" ...
# $ VAR_0075: chr  "08NOV11:00:00:00" "10NOV11:00:00:00" "13DEC11:00:00:00" "23SEP10:00:00:00" ...
# $ VAR_0156: chr  "" "" "" "" ...
# $ VAR_0157: chr  "" "" "" "" ...
# $ VAR_0158: chr  "" "" "" "" ...
# $ VAR_0159: chr  "" "" "" "" ...
# $ VAR_0166: chr  "" "" "" "" ...
# $ VAR_0167: chr  "" "" "" "" ...
# $ VAR_0168: chr  "" "" "" "" ...
# $ VAR_0169: chr  "" "" "" "" ...
# $ VAR_0176: chr  "" "" "" "" ...
# $ VAR_0177: chr  "" "" "" "" ...
# $ VAR_0178: chr  "" "" "" "" ...
# $ VAR_0179: chr  "" "" "" "" ...
# $ VAR_0196: chr  "false" "false" "false" "false" ...
# $ VAR_0200: chr  "FT LAUDERDALE" "SANTEE" "REEDSVILLE" "LIBERTY" ...
# $ VAR_0202: chr  "BatchInquiry" "BatchInquiry" "BatchInquiry" "BatchInquiry" ...
# $ VAR_0204: chr  "29JAN14:21:16:00" "01FEB14:00:11:00" "30JAN14:15:11:00" "01FEB14:00:07:00" ...
# $ VAR_0214: chr  "" "" "" "" ...
# $ VAR_0216: chr  "DS" "DS" "DS" "DS" ...
# $ VAR_0217: chr  "08NOV11:02:00:00" "02OCT12:02:00:00" "13DEC11:02:00:00" "01NOV12:02:00:00" ...
# $ VAR_0222: chr  "C6" "C6" "C6" "C6" ...
# $ VAR_0226: chr  "false" "false" "false" "false" ...
# $ VAR_0229: chr  "false" "false" "false" "false" ...
# $ VAR_0230: chr  "false" "false" "false" "false" ...
# $ VAR_0232: chr  "true" "false" "true" "false" ...
# $ VAR_0236: chr  "true" "true" "true" "true" ...
# $ VAR_0237: chr  "FL" "CA" "WV" "TX" ...
# $ VAR_0239: chr  "false" "false" "false" "false" ...
# $ VAR_0274: chr  "FL" "MI" "WV" "TX" ...
# $ VAR_0283: chr  "S" "S" "S" "S" ...
# $ VAR_0305: chr  "S" "S" "P" "P" ...
# $ VAR_0325: chr  "-1" "H" "R" "H" ...
# $ VAR_0342: chr  "CF" "EC" "UU" "-1" ...
# $ VAR_0352: chr  "O" "O" "R" "R" ...
# $ VAR_0353: chr  "U" "R" "R" "R" ...
# $ VAR_0354: chr  "O" "R" "-1" "-1" ...
# $ VAR_0404: chr  "CHIEF EXECUTIVE OFFICER" "-1" "-1" "-1" ...
# $ VAR_0466: chr  "-1" "I" "-1" "-1" ...
# $ VAR_0467: chr  "-1" "Discharged" "-1" "-1" ...
# $ VAR_0493: chr  "COMMUNITY ASSOCIATION MANAGER" "-1" "-1" "-1" ...
# $ VAR_1934: chr  "IAPS" "IAPS" "IAPS" "RCC" ...









